# =====================================================
# FIREWALL RULES FOR PRODUCTION
# =====================================================
# This file contains firewall rules for production deployment

# Allow SSH access (port 22)
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# Allow HTTP traffic (port 80)
iptables -A INPUT -p tcp --dport 80 -j ACCEPT

# Allow HTTPS traffic (port 443)
iptables -A INPUT -p tcp --dport 443 -j ACCEPT

# Allow established connections
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# Allow loopback interface
iptables -A INPUT -i lo -j ACCEPT

# Block common attack ports
iptables -A INPUT -p tcp --dport 23 -j DROP      # Telnet
iptables -A INPUT -p tcp --dport 21 -j DROP      # FTP
iptables -A INPUT -p tcp --dport 3389 -j DROP    # RDP
iptables -A INPUT -p tcp --dport 1433 -j DROP    # SQL Server
iptables -A INPUT -p tcp --dport 3306 -j DROP    # MySQL
iptables -A INPUT -p tcp --dport 5432 -j DROP    # PostgreSQL

# Rate limiting for connection attempts
iptables -A INPUT -p tcp --dport 22 -m limit --limit 5/minute --limit-burst 10 -j ACCEPT
iptables -A INPUT -p tcp --dport 22 -j DROP

# Block suspicious IP ranges
iptables -A INPUT -s 10.0.0.0/8 -j DROP
iptables -A INPUT -s 172.16.0.0/12 -j DROP
iptables -A INPUT -s 192.168.0.0/16 -j DROP

# Block known malicious IPs (add your own)
# iptables -A INPUT -s 1.2.3.4 -j DROP

# Allow specific trusted IPs (if needed)
# iptables -A INPUT -s YOUR_TRUSTED_IP -j ACCEPT

# Default policy: DROP everything else
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# Save rules
iptables-save > /etc/iptables/rules.v4
